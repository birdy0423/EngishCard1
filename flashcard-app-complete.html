<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å–®å­—å¡æ¸¬é©—æ‡‰ç”¨ç¨‹å¼</title>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body { margin: 0; font-family: system-ui, -apple-system, sans-serif; }
        svg { display: inline-block; vertical-align: middle; }
    </style>
</head>
<body>
    <div id="root"></div>
    
    <script type="text/babel">
        const { useState, useEffect } = React;
        
        // Storage API (ä½¿ç”¨ localStorage)
        if (!window.storage) {
            window.storage = {
                async get(key) {
                    const value = localStorage.getItem(key);
                    return value ? { value } : null;
                },
                async set(key, value) {
                    localStorage.setItem(key, value);
                    return true;
                },
                async delete(key) {
                    localStorage.removeItem(key);
                    return true;
                },
                async list(prefix) {
                    const keys = [];
                    for (let i = 0; i < localStorage.length; i++) {
                        const key = localStorage.key(i);
                        if (key && key.startsWith(prefix)) {
                            keys.push(key);
                        }
                    }
                    return { keys };
                }
            };
        }
        
        // Icons
        const Shuffle = ({ className = "w-6 h-6" }) => (
            <svg className={className} fill="none" stroke="currentColor" strokeWidth="2">
                <polyline points="16 3 21 3 21 8"></polyline>
                <line x1="4" y1="20" x2="21" y2="3"></line>
                <polyline points="21 16 21 21 16 21"></polyline>
                <line x1="15" y1="15" x2="21" y2="21"></line>
                <line x1="4" y1="4" x2="9" y2="9"></line>
            </svg>
        );
        
        const BookOpen = ({ className = "w-6 h-6" }) => (
            <svg className={className} fill="none" stroke="currentColor" strokeWidth="2">
                <path d="M2 3h6a4 4 0 0 1 4 4v14a3 3 0 0 0-3-3H2z"></path>
                <path d="M22 3h-6a4 4 0 0 0-4 4v14a3 3 0 0 1 3-3h7z"></path>
            </svg>
        );
        
        const CheckCircle = ({ className = "w-6 h-6" }) => (
            <svg className={className} fill="none" stroke="currentColor" strokeWidth="2">
                <circle cx="12" cy="12" r="10"></circle>
                <polyline points="9 12 12 15 16 10"></polyline>
            </svg>
        );
        
        const XCircle = ({ className = "w-6 h-6" }) => (
            <svg className={className} fill="none" stroke="currentColor" strokeWidth="2">
                <circle cx="12" cy="12" r="10"></circle>
                <line x1="15" y1="9" x2="9" y2="15"></line>
                <line x1="9" y1="9" x2="15" y2="15"></line>
            </svg>
        );
        
        const RotateCcw = ({ className = "w-6 h-6" }) => (
            <svg className={className} fill="none" stroke="currentColor" strokeWidth="2">
                <polyline points="1 4 1 10 7 10"></polyline>
                <path d="M3.5 15a8.5 8.5 0 1 0 0-6m-2 0L7 10"></path>
            </svg>
        );
        
        const Volume2 = ({ className = "w-6 h-6" }) => (
            <svg className={className} fill="none" stroke="currentColor" strokeWidth="2">
                <polygon points="11 5 6 9 2 9 2 15 6 15 11 19 11 5"></polygon>
                <path d="M15.5 8.5a5 5 0 0 1 0 7"></path>
            </svg>
        );
        
        const Plus = ({ className = "w-6 h-6" }) => (
            <svg className={className} fill="none" stroke="currentColor" strokeWidth="2">
                <line x1="12" y1="5" x2="12" y2="19"></line>
                <line x1="5" y1="12" x2="19" y2="12"></line>
            </svg>
        );
        
        const List = ({ className = "w-6 h-6" }) => (
            <svg className={className} fill="none" stroke="currentColor" strokeWidth="2">
                <line x1="8" y1="6" x2="21" y2="6"></line>
                <line x1="8" y1="12" x2="21" y2="12"></line>
                <line x1="8" y1="18" x2="21" y2="18"></line>
                <line x1="3" y1="6" x2="3.01" y2="6"></line>
                <line x1="3" y1="12" x2="3.01" y2="12"></line>
                <line x1="3" y1="18" x2="3.01" y2="18"></line>
            </svg>
        );
        
        const Trash2 = ({ className = "w-6 h-6" }) => (
            <svg className={className} fill="none" stroke="currentColor" strokeWidth="2">
                <polyline points="3 6 5 6 21 6"></polyline>
                <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path>
            </svg>
        );
        
        const Edit = ({ className = "w-6 h-6" }) => (
            <svg className={className} fill="none" stroke="currentColor" strokeWidth="2">
                <path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"></path>
                <path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"></path>
            </svg>
        );
        
        const Home = ({ className = "w-6 h-6" }) => (
            <svg className={className} fill="none" stroke="currentColor" strokeWidth="2">
                <path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"></path>
                <polyline points="9 22 9 12 15 12 15 22"></polyline>
            </svg>
        );

        // Main App Component
        function FlashcardApp() {
          const [mode, setMode] = useState('lists');
          const [lists, setLists] = useState([]);
          const [currentListId, setCurrentListId] = useState(null);
          const [listName, setListName] = useState('');
          const [inputText, setInputText] = useState('');
          const [flashcards, setFlashcards] = useState([]);
          const [quizCards, setQuizCards] = useState([]);
          const [wrongCards, setWrongCards] = useState([]);
          const [currentIndex, setCurrentIndex] = useState(0);
          const [questionType, setQuestionType] = useState('');
          const [options, setOptions] = useState([]);
          const [selectedAnswer, setSelectedAnswer] = useState(null);
          const [showFeedback, setShowFeedback] = useState(false);
          const [isCorrect, setIsCorrect] = useState(false);
          const [stats, setStats] = useState({ correct: 0, total: 0 });
          const [isLoading, setIsLoading] = useState(true);

          useEffect(() => {
            loadLists();
          }, []);

          const loadLists = async () => {
            try {
              const result = await window.storage.list('flashcard_list:');
              if (result && result.keys) {
                const loadedLists = await Promise.all(
                  result.keys.map(async (key) => {
                    try {
                      const data = await window.storage.get(key);
                      return data ? JSON.parse(data.value) : null;
                    } catch (e) {
                      return null;
                    }
                  })
                );
                setLists(loadedLists.filter(list => list !== null));
              }
            } catch (error) {
              console.log('é¦–æ¬¡ä½¿ç”¨ï¼Œæ²’æœ‰å·²ä¿å­˜çš„åˆ—è¡¨');
            }
            setIsLoading(false);
          };

          const saveList = async (name, cards) => {
            const id = currentListId || `list_${Date.now()}`;
            const listData = {
              id,
              name,
              cards,
              updatedAt: new Date().toISOString()
            };
            
            try {
              await window.storage.set(`flashcard_list:${id}`, JSON.stringify(listData));
              await loadLists();
              return id;
            } catch (error) {
              alert('ä¿å­˜å¤±æ•—ï¼Œè«‹é‡è©¦');
              console.error(error);
              return null;
            }
          };

          const deleteList = async (id) => {
            if (!confirm('ç¢ºå®šè¦åˆªé™¤é€™å€‹å–®å­—åˆ—è¡¨å—ï¼Ÿ')) return;
            
            try {
              await window.storage.delete(`flashcard_list:${id}`);
              await loadLists();
            } catch (error) {
              alert('åˆªé™¤å¤±æ•—ï¼Œè«‹é‡è©¦');
            }
          };

          const speak = (text, lang = 'en-US') => {
            if ('speechSynthesis' in window) {
              window.speechSynthesis.cancel();
              const utterance = new SpeechSynthesisUtterance(text);
              utterance.lang = lang;
              utterance.rate = 0.9;
              window.speechSynthesis.speak(utterance);
            }
          };

          const shuffleArray = (array) => {
            const shuffled = [...array];
            for (let i = shuffled.length - 1; i > 0; i--) {
              const j = Math.floor(Math.random() * (i + 1));
              [shuffled[i], shuffled[j]] = [shuffled[j], shuffled[i]];
            }
            return shuffled;
          };

          const parseFlashcards = (text) => {
            const lines = text.trim().split('\n');
            const cards = [];
            
            lines.forEach((line, index) => {
              const parts = line.split(',').map(p => p.trim());
              if (parts.length >= 3 && parts[0] && parts[1] && parts[2]) {
                cards.push({
                  id: `card_${index}_${Date.now()}`,
                  english: parts[0],
                  partOfSpeech: parts[1],
                  chinese: parts[2]
                });
              } else if (parts.length === 2 && parts[0] && parts[1]) {
                cards.push({
                  id: `card_${index}_${Date.now()}`,
                  english: parts[0],
                  partOfSpeech: '',
                  chinese: parts[1]
                });
              }
            });
            
            return cards;
          };

          const createOrEditList = (list = null) => {
            if (list) {
              setCurrentListId(list.id);
              setListName(list.name);
              setInputText(list.cards.map(c => `${c.english},${c.partOfSpeech},${c.chinese}`).join('\n'));
            } else {
              setCurrentListId(null);
              setListName('');
              setInputText('');
            }
            setMode('input');
          };

          const startQuiz = async () => {
            const cards = parseFlashcards(inputText);
            if (cards.length < 2) {
              alert('è«‹è‡³å°‘è¼¸å…¥2çµ„å–®å­—å¡ï¼\næ ¼å¼ï¼šè‹±æ–‡,è©æ€§,ä¸­æ–‡ï¼ˆæ¯è¡Œä¸€çµ„ï¼‰');
              return;
            }

            if (!listName.trim()) {
              alert('è«‹è¼¸å…¥åˆ—è¡¨åç¨±ï¼');
              return;
            }

            const savedId = await saveList(listName, cards);
            if (!savedId) {
              // å³ä½¿ä¿å­˜å¤±æ•—ï¼Œé‚„æ˜¯å¯ä»¥é–‹å§‹æ¸¬é©—
              console.warn('Save failed but continuing with quiz');
            }

            const shuffledCards = shuffleArray(cards);
            setFlashcards(cards);
            setQuizCards(shuffledCards);
            setWrongCards([]);
            setCurrentIndex(0);
            setStats({ correct: 0, total: 0 });
            setMode('quiz');
            generateQuestion(shuffledCards, 0, cards);
          };

          const startQuizFromList = (list) => {
            const shuffledCards = shuffleArray(list.cards);
            setFlashcards(list.cards);
            setQuizCards(shuffledCards);
            setWrongCards([]);
            setCurrentIndex(0);
            setStats({ correct: 0, total: 0 });
            setCurrentListId(list.id);
            setListName(list.name);
            setMode('quiz');
            generateQuestion(shuffledCards, 0, list.cards);
          };

          const generateQuestion = (quizCardsArray, index, allCardsArray) => {
            if (index >= quizCardsArray.length) return;

            const currentCard = quizCardsArray[index];
            const type = Math.random() > 0.5 ? 'en-to-zh' : 'zh-to-en';
            setQuestionType(type);

            if (type === 'en-to-zh') {
              setTimeout(() => speak(currentCard.english), 300);
            }

            const correctAnswer = type === 'en-to-zh' ? currentCard.chinese : currentCard.english;
            const wrongOptions = [];
            const availableCards = [...allCardsArray];
            
            while (wrongOptions.length < 3 && wrongOptions.length < availableCards.length - 1) {
              const randomCard = availableCards[Math.floor(Math.random() * availableCards.length)];
              const optionText = type === 'en-to-zh' ? randomCard.chinese : randomCard.english;
              
              if (optionText !== correctAnswer && !wrongOptions.includes(optionText)) {
                wrongOptions.push(optionText);
              }
            }

            const allOptions = [...wrongOptions, correctAnswer];
            const shuffledOptions = allOptions.sort(() => Math.random() - 0.5);
            
            setOptions(shuffledOptions);
            setSelectedAnswer(null);
            setShowFeedback(false);
          };

          const checkAnswer = (answer) => {
            if (showFeedback) return;

            const currentCard = quizCards[currentIndex];
            const correctAnswer = questionType === 'en-to-zh' ? currentCard.chinese : currentCard.english;
            const correct = answer === correctAnswer;

            setSelectedAnswer(answer);
            setIsCorrect(correct);
            setShowFeedback(true);
            
            setStats(prev => ({
              correct: prev.correct + (correct ? 1 : 0),
              total: prev.total + 1
            }));

            if (!correct && !wrongCards.some(card => card.id === currentCard.id)) {
              setWrongCards(prev => [...prev, currentCard]);
            }
          };

          const nextQuestion = () => {
            const nextIndex = currentIndex + 1;
            
            if (nextIndex >= quizCards.length) {
              if (wrongCards.length > 0) {
                const shuffledWrongCards = shuffleArray(wrongCards);
                setQuizCards(shuffledWrongCards);
                setWrongCards([]);
                setCurrentIndex(0);
                generateQuestion(shuffledWrongCards, 0, flashcards);
              } else {
                setMode('completed');
              }
            } else {
              setCurrentIndex(nextIndex);
              generateQuestion(quizCards, nextIndex, flashcards);
            }
          };

          const backToLists = () => {
            setMode('lists');
            setCurrentListId(null);
            setListName('');
            setInputText('');
            setFlashcards([]);
            setQuizCards([]);
            setWrongCards([]);
            setCurrentIndex(0);
            setStats({ correct: 0, total: 0 });
            loadLists();
          };

          if (isLoading) {
            return (
              <div className="min-h-screen bg-gradient-to-br from-blue-50 to-indigo-100 flex items-center justify-center">
                <div className="text-center">
                  <BookOpen className="w-12 h-12 text-indigo-600 mx-auto mb-4 animate-pulse" />
                  <p className="text-gray-600">è¼‰å…¥ä¸­...</p>
                </div>
              </div>
            );
          }

          if (mode === 'lists') {
            return (
              <div className="min-h-screen bg-gradient-to-br from-blue-50 to-indigo-100 p-6">
                <div className="max-w-4xl mx-auto">
                  <div className="bg-white rounded-2xl shadow-xl p-8">
                    <div className="flex items-center justify-between mb-6">
                      <div className="flex items-center gap-3">
                        <List className="w-8 h-8 text-indigo-600" />
                        <h1 className="text-3xl font-bold text-gray-800">æˆ‘çš„å–®å­—åˆ—è¡¨</h1>
                      </div>
                      <button
                        onClick={() => createOrEditList()}
                        className="bg-indigo-600 hover:bg-indigo-700 text-white font-semibold px-6 py-3 rounded-lg transition flex items-center gap-2"
                      >
                        <Plus className="w-5 h-5" />
                        æ–°å¢åˆ—è¡¨
                      </button>
                    </div>

                    {lists.length === 0 ? (
                      <div className="text-center py-16">
                        <BookOpen className="w-16 h-16 text-gray-300 mx-auto mb-4" />
                        <p className="text-gray-500 text-lg mb-6">é‚„æ²’æœ‰ä»»ä½•å–®å­—åˆ—è¡¨</p>
                        <button
                          onClick={() => createOrEditList()}
                          className="bg-indigo-600 hover:bg-indigo-700 text-white font-semibold px-8 py-3 rounded-lg transition"
                        >
                          å»ºç«‹ç¬¬ä¸€å€‹åˆ—è¡¨
                        </button>
                      </div>
                    ) : (
                      <div className="grid gap-4">
                        {lists.map((list) => (
                          <div key={list.id} className="border-2 border-gray-200 rounded-xl p-6 hover:border-indigo-300 transition">
                            <div className="flex items-start justify-between">
                              <div className="flex-1">
                                <h3 className="text-xl font-bold text-gray-800 mb-2">{list.name}</h3>
                                <div className="flex items-center gap-4 text-sm text-gray-600">
                                  <span>ğŸ“š {list.cards.length} å€‹å–®å­—</span>
                                  <span>ğŸ• {new Date(list.updatedAt).toLocaleDateString('zh-TW')}</span>
                                </div>
                              </div>
                              <div className="flex gap-2">
                                <button
                                  onClick={() => createOrEditList(list)}
                                  className="p-2 text-gray-600 hover:text-indigo-600 hover:bg-indigo-50 rounded-lg transition"
                                  title="ç·¨è¼¯"
                                >
                                  <Edit className="w-5 h-5" />
                                </button>
                                <button
                                  onClick={() => deleteList(list.id)}
                                  className="p-2 text-gray-600 hover:text-red-600 hover:bg-red-50 rounded-lg transition"
                                  title="åˆªé™¤"
                                >
                                  <Trash2 className="w-5 h-5" />
                                </button>
                              </div>
                            </div>
                            <button
                              onClick={() => startQuizFromList(list)}
                              className="w-full mt-4 bg-indigo-600 hover:bg-indigo-700 text-white font-semibold py-3 rounded-lg transition flex items-center justify-center gap-2"
                            >
                              <Shuffle className="w-5 h-5" />
                              é–‹å§‹æ¸¬é©—
                            </button>
                          </div>
                        ))}
                      </div>
                    )}
                  </div>
                </div>
              </div>
            );
          }

          if (mode === 'input') {
            return (
              <div className="min-h-screen bg-gradient-to-br from-blue-50 to-indigo-100 p-6">
                <div className="max-w-3xl mx-auto">
                  <div className="bg-white rounded-2xl shadow-xl p-8">
                    <button
                      onClick={backToLists}
                      className="text-indigo-600 hover:text-indigo-700 font-medium mb-6 flex items-center gap-2"
                    >
                      â† è¿”å›åˆ—è¡¨
                    </button>

                    <div className="flex items-center gap-3 mb-6">
                      <BookOpen className="w-8 h-8 text-indigo-600" />
                      <h1 className="text-3xl font-bold text-gray-800">
                        {currentListId ? 'ç·¨è¼¯åˆ—è¡¨' : 'æ–°å¢åˆ—è¡¨'}
                      </h1>
                    </div>

                    <div className="mb-6">
                      <label className="block text-sm font-medium text-gray-700 mb-2">
                        åˆ—è¡¨åç¨±
                      </label>
                      <input
                        type="text"
                        className="w-full p-3 border-2 border-gray-300 rounded-lg focus:border-indigo-500 focus:ring focus:ring-indigo-200 transition"
                        placeholder="ä¾‹å¦‚ï¼šTOEIC æ ¸å¿ƒå–®å­—ã€æ—¥å¸¸è‹±æ–‡..."
                        value={listName}
                        onChange={(e) => setListName(e.target.value)}
                      />
                    </div>
                    
                    <div className="mb-6">
                      <label className="block text-sm font-medium text-gray-700 mb-2">
                        è¼¸å…¥å–®å­—å¡ï¼ˆæ ¼å¼ï¼šè‹±æ–‡,è©æ€§,ä¸­æ–‡ï¼Œæ¯è¡Œä¸€çµ„ï¼‰
                      </label>
                      <textarea
                        className="w-full h-64 p-4 border-2 border-gray-300 rounded-lg focus:border-indigo-500 focus:ring focus:ring-indigo-200 transition font-mono text-sm"
                        placeholder="ç¯„ä¾‹ï¼š&#10;apple,n.,è˜‹æœ&#10;beautiful,adj.,ç¾éº—çš„&#10;run,v.,è·‘&#10;quickly,adv.,å¿«é€Ÿåœ°"
                        value={inputText}
                        onChange={(e) => setInputText(e.target.value)}
                      />
                    </div>

                    <div className="bg-blue-50 border border-blue-200 rounded-lg p-4 mb-6">
                      <h3 className="font-semibold text-blue-900 mb-2">ğŸ’¡ ä½¿ç”¨èªªæ˜</h3>
                      <ul className="text-sm text-blue-800 space-y-1">
                        <li>â€¢ æ ¼å¼ï¼šè‹±æ–‡,è©æ€§,ä¸­æ–‡ï¼ˆç”¨é€—è™Ÿåˆ†éš”ï¼‰</li>
                        <li>â€¢ è©æ€§ç¯„ä¾‹ï¼šn.(åè©) v.(å‹•è©) adj.(å½¢å®¹è©) adv.(å‰¯è©)</li>
                        <li>â€¢ ä¹Ÿå¯ä»¥çœç•¥è©æ€§ï¼šè‹±æ–‡,ä¸­æ–‡</li>
                        <li>â€¢ è‹±æ–‡é¡Œç›®æœƒè‡ªå‹•ç™¼éŸ³</li>
                        <li>â€¢ è‡³å°‘éœ€è¦2çµ„å–®å­—æ‰èƒ½é–‹å§‹æ¸¬é©—</li>
                      </ul>
                    </div>

                    <button
                      onClick={startQuiz}
                      className="w-full bg-indigo-600 hover:bg-indigo-700 text-white font-semibold py-4 rounded-lg transition flex items-center justify-center gap-2 shadow-lg"
                    >
                      <Shuffle className="w-5 h-5" />
                      ä¿å­˜ä¸¦é–‹å§‹æ¸¬é©—
                    </button>
                  </div>
                </div>
              </div>
            );
          }

          if (mode === 'quiz') {
            const currentCard = quizCards[currentIndex];
            const question = questionType === 'en-to-zh' ? currentCard.english : currentCard.chinese;
            const correctAnswer = questionType === 'en-to-zh' ? currentCard.chinese : currentCard.english;
            const progress = ((currentIndex + 1) / quizCards.length) * 100;

            return (
              <div className="min-h-screen bg-gradient-to-br from-purple-50 to-pink-100 p-6">
                <div className="max-w-2xl mx-auto">
                  <div className="bg-white rounded-2xl shadow-xl p-8">
                    <div className="flex justify-between items-center mb-6">
                      <button
                        onClick={() => {
                          const shouldExit = confirm('ç¢ºå®šè¦é›¢é–‹æ¸¬é©—å—ï¼Ÿé€²åº¦å°‡ä¸æœƒä¿å­˜ã€‚');
                          if (shouldExit) {
                            setMode('lists');
                            setFlashcards([]);
                            setQuizCards([]);
                            setWrongCards([]);
                            setCurrentIndex(0);
                            setStats({ correct: 0, total: 0 });
                            loadLists();
                          }
                        }}
                        className="bg-red-600 hover:bg-red-700 text-white font-bold px-6 py-3 rounded-lg transition flex items-center gap-2 shadow-lg"
                      >
                        <Home className="w-5 h-5" />
                        å›ä¸»é¸å–®
                      </button>
                      <span className="text-sm text-gray-600 font-medium">
                        {currentIndex + 1} / {quizCards.length}
                      </span>
                    </div>

                    <div className="mb-6">
                      <div className="flex justify-between text-sm text-gray-600 mb-2">
                        <span>é¡Œç›® {currentIndex + 1} / {quizCards.length}</span>
                        <span>æ­£ç¢ºç‡ï¼š{stats.total > 0 ? Math.round((stats.correct / stats.total) * 100) : 0}%</span>
                      </div>
                      <div className="w-full bg-gray-200 rounded-full h-3">
                        <div 
                          className="bg-gradient-to-r from-indigo-500 to-purple-600 h-3 rounded-full transition-all duration-300"
                          style={{ width: `${progress}%` }}
                        />
                      </div>
                    </div>

                    <div className="mb-8">
                      <div className="flex justify-center items-center gap-2 mb-4">
                        <span className="inline-block bg-indigo-100 text-indigo-800 text-sm font-semibold px-4 py-2 rounded-full">
                          {questionType === 'en-to-zh' ? 'è‹±æ–‡ â†’ ä¸­æ–‡' : 'ä¸­æ–‡ â†’ è‹±æ–‡'}
                        </span>
                        {currentCard.partOfSpeech && (
                          <span className="inline-block bg-purple-100 text-purple-800 text-sm font-semibold px-3 py-2 rounded-full">
                            {currentCard.partOfSpeech}
                          </span>
                        )}
                      </div>
                      <div className="bg-gradient-to-r from-indigo-500 to-purple-600 text-white rounded-xl p-8 text-center relative">
                        <p className="text-4xl font-bold mb-4">{question}</p>
                        {questionType === 'en-to-zh' && (
                          <button
                            onClick={() => speak(currentCard.english)}
                            className="absolute bottom-4 right-4 bg-white/20 hover:bg-white/30 p-3 rounded-full transition"
                            title="é‡æ–°ç™¼éŸ³"
                          >
                            <Volume2 className="w-6 h-6" />
                          </button>
                        )}
                      </div>
                    </div>

                    <div className="space-y-3 mb-6">
                      {options.map((option, index) => {
                        const isSelected = selectedAnswer === option;
                        const isCorrectOption = option === correctAnswer;
                        let btnClass = "w-full p-4 text-left rounded-lg border-2 transition font-medium ";
                        
                        if (!showFeedback) {
                          btnClass += "border-gray-300 hover:border-indigo-500 hover:bg-indigo-50 cursor-pointer";
                        } else if (isSelected && isCorrect) {
                          btnClass += "border-green-500 bg-green-50 text-green-800";
                        } else if (isSelected && !isCorrect) {
                          btnClass += "border-red-500 bg-red-50 text-red-800";
                        } else if (isCorrectOption) {
                          btnClass += "border-green-500 bg-green-50 text-green-800";
                        } else {
                          btnClass += "border-gray-300 bg-gray-50 text-gray-500";
                        }

                        return (
                          <button
                            key={index}
                            onClick={() => checkAnswer(option)}
                            disabled={showFeedback}
                            className={btnClass}
                          >
                            <div className="flex items-center justify-between">
                              <span className="text-lg">{option}</span>
                              {showFeedback && isSelected && (
                                isCorrect ? 
                                  <CheckCircle className="w-6 h-6 text-green-600" /> :
                                  <XCircle className="w-6 h-6 text-red-600" />
                              )}
                              {showFeedback && !isSelected && isCorrectOption && (
                                <CheckCircle className="w-6 h-6 text-green-600" />
                              )}
                            </div>
                          </button>
                        );
                      })}
                    </div>

                    {showFeedback && (
                      <div className={`rounded-lg p-6 mb-6 ${isCorrect ? 'bg-green-50 border-2 border-green-200' : 'bg-red-50 border-2 border-red-200'}`}>
                        <div className="flex items-start gap-3">
                          {isCorrect ? 
                            <CheckCircle className="w-6 h-6 text-green-600 flex-shrink-0 mt-1" /> :
                            <XCircle className="w-6 h-6 text-red-600 flex-shrink-0 mt-1" />
                          }
                          <div className="flex-1">
                            <p className={`font-bold text-lg mb-2 ${isCorrect ? 'text-green-800' : 'text-red-800'}`}>
                              {isCorrect ? 'ç­”å°äº†ï¼ğŸ‰' : 'ç­”éŒ¯äº†'}
                            </p>
                            <div className="text-sm space-y-1">
                              <div className="flex items-center gap-2">
                                <p className="font-medium text-gray-700">
                                  {currentCard.english} {currentCard.partOfSpeech && `(${currentCard.partOfSpeech})`} = {currentCard.chinese}
                                </p>
                                <button
                                  onClick={() => speak(currentCard.english)}
                                  className="p-1 hover:bg-white/50 rounded transition"
                                  title="ç™¼éŸ³"
                                >
                                  <Volume2 className="w-4 h-4 text-indigo-600" />
                                </button>
                              </div>
                              {!isCorrect && (
                                <p className="text-red-700">é€™å€‹å–®å­—æœƒå†æ¬¡å‡ºç¾ï¼Œç›´åˆ°ç­”å°ç‚ºæ­¢</p>
                              )}
                            </div>
                          </div>
                        </div>
                      </div>
                    )}

                    {showFeedback && (
                      <button
                        onClick={nextQuestion}
                        className="w-full bg-indigo-600 hover:bg-indigo-700 text-white font-semibold py-4 rounded-lg transition shadow-lg"
                      >
                        ä¸‹ä¸€é¡Œ
                      </button>
                    )}
                  </div>
                </div>
              </div>
            );
          }

          if (mode === 'completed') {
            const accuracy = Math.round((stats.correct / stats.total) * 100);
            
            return (
              <div className="min-h-screen bg-gradient-to-br from-green-50 to-emerald-100 p-6 flex items-center justify-center">
                <div className="max-w-md w-full bg-white rounded-2xl shadow-xl p-8 text-center">
                  <div className="mb-6">
                    <CheckCircle className="w-20 h-20 text-green-500 mx-auto mb-4" />
                    <h2 className="text-3xl font-bold text-gray-800 mb-2">æ­å–œå®Œæˆï¼ğŸŠ</h2>
                    <p className="text-gray-600">ä½ å·²ç¶“æŒæ¡æ‰€æœ‰å–®å­—äº†</p>
                  </div>

                  <div className="bg-gradient-to-r from-green-50 to-emerald-50 rounded-xl p-6 mb-6">
                    <div className="grid grid-cols-2 gap-4">
                      <div>
                        <p className="text-gray-600 text-sm mb-1">ç¸½é¡Œæ•¸</p>
                        <p className="text-3xl font-bold text-gray-800">{stats.total}</p>
                      </div>
                      <div>
                        <p className="text-gray-600 text-sm mb-1">æ­£ç¢ºç‡</p>
                        <p className="text-3xl font-bold text-green-600">{accuracy}%</p>
                      </div>
                    </div>
                  </div>

                  <div className="space-y-3">
                    <button
                      onClick={() => {
                        const shuffledCards = shuffleArray(flashcards);
                        setQuizCards(shuffledCards);
                        setWrongCards([]);
                        setCurrentIndex(0);
                        setStats({ correct: 0, total: 0 });
                        setMode('quiz');
                        generateQuestion(shuffledCards, 0, flashcards);
                      }}
                      className="w-full bg-indigo-600 hover:bg-indigo-700 text-white font-semibold py-3 rounded-lg transition"
                    >
                      å†æ¸¬é©—ä¸€æ¬¡
                    </button>
                    <button
                      onClick={backToLists}
                      className="w-full bg-gray-200 hover:bg-gray-300 text-gray-700 font-semibold py-3 rounded-lg transition flex items-center justify-center gap-2"
                    >
                      <RotateCcw className="w-4 h-4" />
                      è¿”å›åˆ—è¡¨
                    </button>
                  </div>
                </div>
              </div>
            );
          }

          return null;
        }

        // Render the app
        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<FlashcardApp />);
    </script>
</body>
</html>
